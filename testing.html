

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Testing &mdash; PyFtdi  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Raleway" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="EEPROM management" href="eeprom.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PyFtdi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="urlscheme.html">URL Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pinout.html">FTDI device pinout</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpio.html">GPIOs</a></li>
<li class="toctree-l1"><a class="reference internal" href="eeprom.html">EEPROM management</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-tests">Hardware tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-test-framework">Virtual test framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#beware-wip">Beware: WIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#eeprom-content">EEPROM content</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#availability">Availability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyFtdi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/testing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>Testing PyFTDI is challenging because it relies on several pieces of hardware:</p>
<ul class="simple">
<li><p>one or more FTDI device</p></li>
<li><p>I<sup>2</sup>C, SPI, JTAG bus slaves or communication equipment for UART</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">tests</span></code> directory contain several tests files, which are primarily aimed
at demonstrating usage of PyFTDI in common use cases.</p>
<p>Most unit tests are disabled, as they require specific slaves, with a dedicated
HW wiring. Reproducing such test environments can be challenging, as it
requires dedicated test benchs.</p>
<p>This is a growing concern as PyFTDI keeps evolving, and up to now, regression
tests were hard to run.</p>
</section>
<section id="hardware-tests">
<h2>Hardware tests<a class="headerlink" href="#hardware-tests" title="Link to this heading"></a></h2>
<p>Please refer to the <code class="docutils literal notranslate"><span class="pre">pyftdi/tests</span></code> directory. There is one file dedicated to
each feature to test. Note that you need to read and edit these tests files to
fit your actual test environment, and enable the proper unit test cases, as
most are actually disabled by default.</p>
<p>You need specific bus slaves to perform most of these tests.</p>
</section>
<section id="virtual-test-framework">
<span id="virtual-framework"></span><h2>Virtual test framework<a class="headerlink" href="#virtual-test-framework" title="Link to this heading"></a></h2>
<p>With PyFTDI v0.45, a new test module enables PyFTDI API partial testing using a
pure software environment with no hardware. This also eases automatic testing
within a continuous integration environment.</p>
<p>This new module implements a virtual USB backend for PyUSB, which creates some
kind of virtual, limited USB stack. The PyUSB can be told to substitute the
native platform’s libusb with this module.</p>
<p>This module, <code class="docutils literal notranslate"><span class="pre">usbvirt</span></code> can be dynamically confifured with the help of YaML
definition files to create one or more virtual FTDI devices on a virtual USB
bus topology. This enables to test <code class="docutils literal notranslate"><span class="pre">usbtools</span></code> module to enumerate, detect,
report and access FTDI devices using the regular <a class="reference internal" href="urlscheme.html"><span class="doc">URL Scheme</span></a> syntax.</p>
<p><code class="docutils literal notranslate"><span class="pre">usbvirt</span></code> also routes all vendor-specific USB API calls to a secondary
<code class="docutils literal notranslate"><span class="pre">ftdivirt</span></code> module, which is in charge of handling all FTDI USB requests.</p>
<p>This module enables testing <a class="reference external" href="https://www.github.com/eblot/pyftdi">PyFtdi</a> APIs. It also re-uses the MPSSE tracker
engine to decode and verify MPSSE requests used to support I<sup>2</sup>C, SPI and UART
features.</p>
<p>For now, it is able to emulate most of GPIO requests (async, sync and MPSSE)
and UART input/output. It also manages the frequency and baudrate settings.</p>
<p>It is not able to emulate the MPSSE commands (with the exception of set and get
GPIO values), as it represents a massive workload…</p>
<section id="beware-wip">
<h3>Beware: WIP<a class="headerlink" href="#beware-wip" title="Link to this heading"></a></h3>
<p>This is an experimental work in progress, which is its early inception stage.</p>
<p>It has nevertheless already revealed a couple of bugs that had been hiding
within <a class="reference external" href="https://www.github.com/eblot/pyftdi">PyFtdi</a> for years.</p>
<p>There is a large work effort ahead to be able to support more use cases and
tests more APIs, and many unit tests to write.</p>
<p>It cannot replace hardware tests with actual boards and slaves, but should
simplify test setup and help avoiding regression issues.</p>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h3>
<p>No hardware is required to run these tests, to even a single FTDI device.</p>
<p>The test configuration files are described in YaML file format, therefore the
<a class="reference external" href="https://pypi.org/project/ruamel.yaml">ruamel.yaml</a> package is required.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">PYTHONPATH</span><span class="o">=.</span> <span class="n">FTDI_LOGLEVEL</span><span class="o">=</span><span class="n">info</span> <span class="n">pyftdi</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">mockusb</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">pyftdi/tests/resources</span></code> directory contains definition files which are
loaded by the mock unit tests.</p>
<p>Although it is possible to create fine grained USB device definitions, the
configuration loader tries to automatically define missing parts to match the
USB device topology of FTDI devices.</p>
<p>This enables to create simple definition files without having to mess with low
level USB definitions whenever possible.</p>
<section id="eeprom-content">
<h4>EEPROM content<a class="headerlink" href="#eeprom-content" title="Link to this heading"></a></h4>
<p>The <a class="reference internal" href="eeprom.html#ftconf"><span class="std std-ref">EEPROM configuration tool</span></a> tool can be used to load, modify and generate the content of
a virtual EEPROM, see <a class="reference internal" href="eeprom.html"><span class="doc">EEPROM management</span></a>.</p>
</section>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h4>
<blockquote>
<div><ul class="simple">
<li><p>An example of a nearly comprehensive syntax can be found in <code class="docutils literal notranslate"><span class="pre">ft232h.yaml</span></code>.</p></li>
<li><p>Another, much more simple example with only mandatory settings can be found
in <code class="docutils literal notranslate"><span class="pre">ft230x.yaml</span></code>.</p></li>
<li><p>An example of multiple FTDI device definitions can be found in
<code class="docutils literal notranslate"><span class="pre">ftmany.yaml</span></code></p></li>
</ul>
</div></blockquote>
</section>
</section>
</section>
<section id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Link to this heading"></a></h2>
<p>Note that unit tests and the virtual infrastructure are not included in the
distributed Python packages, they are only available from the git repository.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="eeprom.html" class="btn btn-neutral float-left" title="EEPROM management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2010-2024, Emmanuel Blot &lt;emmanuel.blot@free.fr&gt;.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>